# 1) ÐŸÑ–Ð´Ñ€Ð°Ñ…Ð¾Ð²ÑƒÑ”Ð¼Ð¾ Ðº-ÑÑ‚ÑŒ Ð¿Ð¾Ð·Ð¸Ñ‚Ð¸Ð²Ð½Ð¸Ñ… Ñ‚Ð° Ð½ÐµÐ³Ð°Ñ‚Ð¸Ð²Ð½Ð¸Ñ… Ð¿Ð°Ñ€ Ð´Ð»Ñ ÐºÐ¾Ð¶Ð½Ð¾Ñ— Ð»ÐµÐ¼Ð¸
# 2) ÐŸÑ–Ð´Ñ€Ð°Ñ…Ð¾Ð²ÑƒÑ”Ð¼Ð¾ Ð·Ð°Ð³Ð°Ð»ÑŒÐ½Ñƒ Ðº-ÑÑ‚ÑŒ Ð¿Ð¾Ð·Ð¸Ñ‚Ð¸Ð²Ð½Ð¸Ñ… (X) Ñ‚Ð° Ð½ÐµÐ³Ð°Ñ‚Ð¸Ð²Ð½Ð¸Ñ… (3X) Ð¿Ð°Ñ€
# 3) Ð¤Ð¾Ñ€Ð¼ÑƒÐ²Ð°Ð½Ð½Ñ Ñ‚Ñ€ÐµÐ½ÑƒÐ²Ð°Ð»ÑŒÐ½Ð¸Ñ… Ñ‚Ð° Ñ‚ÐµÑÑ‚ÑƒÐ²Ð°Ð»ÑŒÐ½Ð¸Ñ… Ð½Ð°Ð±Ð¾Ñ€Ñ–Ð² (Ð²Ñ–Ð´Ð½Ð¾ÑˆÐµÐ½Ð½Ñ 80/20) Ð· ÑƒÑ€Ð°Ñ…ÑƒÐ²Ð°Ð½Ð½ÑÐ¼ Ð½Ð°ÑÑ‚ÑƒÐ¿Ð½Ð¸Ñ… Ñ„Ð°ÐºÑ‚Ð¾Ñ€Ñ–Ð²:
# ---> 1. ÐŸÐ°Ñ€Ð¸ Ñ‚Ñ€ÐµÐ½ÑƒÐ²Ð°Ð»ÑŒÐ½Ð¸Ñ… Ñ‚Ð° Ñ‚ÐµÑÑ‚ÑƒÐ²Ð°Ð»ÑŒÐ½Ð¸Ñ… Ð½Ð°Ð±Ð¾Ñ€Ñ–Ð² Ð½Ðµ Ð¿Ð¾Ð²Ð¸Ð½Ð½Ñ– Ð¼Ð°Ñ‚Ð¸ ÑÐ¿Ñ–Ð»ÑŒÐ½Ñ– Ð»ÐµÐ¼Ð¸, Ð° ÑÐ°Ð¼Ðµ:
# -------> 1.1. Ð£ Ñ‚Ñ€ÐµÐ½ÑƒÐ²Ð°Ð»ÑŒÐ½Ð¾Ð¼Ñƒ Ð½Ð°Ð±Ð¾Ñ€Ñ– Ð²Ð¸ÐºÐ¾Ñ€Ð¸ÑÑ‚Ð¾Ð²ÑƒÐ²Ð°Ñ‚Ð¸Ð¼ÑƒÑ‚ÑŒÑÑ Ð¿ÐµÑ€ÑˆÑ– X Ð»ÐµÐ¼ Ð²Ñ–Ð´ÑÐ¾Ñ€Ñ‚Ð¾Ð²Ð°Ð½Ð¸Ñ…
#               Ð·Ð° ÐºÑ–Ð»ÑŒÐºÑ–ÑÑ‚ÑŽ Ð¿Ð¾Ð·Ð¸Ñ‚Ð¸Ð²Ð½Ð¸Ñ… Ð¿Ñ€Ð¸ÐºÐ»Ð°Ð´Ñ–Ð² Ñƒ ÑÐ¿Ð°Ð´. Ð¿Ð¾Ñ€ÑÐ´ÐºÑƒ, Ð·Ð° ÑƒÐ¼Ð¾Ð²Ð¸, Ñ‰Ð¾ ÑÑƒÐ¼Ð°Ñ€Ð½Ð° Ðº-ÑÑ‚ÑŒ Ð¿Ð¾Ð·Ð¸Ñ‚Ð¸Ð²Ð½Ð¸Ñ… Ð¿Ð°Ñ€ Ñ†Ð¸Ñ… X Ð»ÐµÐ¼ 
#               Ð½Ðµ Ð¿ÐµÑ€ÐµÐ²Ð¸Ñ‰ÑƒÑ” 80% ÑƒÑÑ–Ñ… Ð´Ð¾ÑÑ‚ÑƒÐ¿Ð½Ð¸Ñ… Ð¿Ð¾Ð·Ð¸Ñ‚Ð¸Ð²Ð½Ð¸Ñ… Ð¿Ð°Ñ€. Ð¢Ð¾Ð±Ñ‚Ð¾ Ð²Ð¸ÐºÐ¾Ñ€Ð¸ÑÑ‚Ð¾Ð²ÑƒÐ²Ð°Ñ‚Ð¸Ð¼ÑƒÑ‚ÑŒÑÑ Ð»ÐµÐ¼Ð¸ Ð· 
#               Ð½Ð°Ð¹Ð±Ñ–Ð»ÑŒÑˆÐ¾ÑŽ Ðº-ÑÑ‚ÑŽ Ð¿Ð¾Ð·Ð¸Ñ‚Ð¸Ð²Ð½Ð¸Ñ… Ð¿Ð°Ñ€, Ñ‰Ð¾ Ð´Ð¾Ð·Ð²Ð¾Ð»Ð¸Ñ‚ÑŒ Ð¼Ð¾Ð´ÐµÐ»Ñ– Ð½Ð°Ð²Ñ‡Ð°Ñ‚Ð¸ÑÑ Ð½Ð° Ñ€Ñ–Ð·Ð½Ð¾Ð¼Ð°Ð½Ñ–Ñ‚Ð½Ð¸Ñ… Ð¿Ð¾Ð·Ð¸Ñ‚Ð¸Ð²Ð½Ð¸Ñ… Ð·Ñ€Ð°Ð·ÐºÐ°Ñ… Ñ– 
#               Ð¿Ð¾ÐºÑ€Ð°Ñ‰Ð¸Ñ‚ÑŒ Ñ—Ñ— Ð·Ð´Ð°Ñ‚Ð½Ñ–ÑÑ‚ÑŒ Ð²Ð¸Ð·Ð½Ð°Ñ‡Ð°Ñ‚Ð¸ ÑÑ…Ð¾Ð¶Ñ–ÑÑ‚ÑŒ! Ð´Ð»Ñ Ð½Ð¾Ð²Ð¸Ñ… Ð¿Ð°Ñ€.
# ---> 2. Ðš-ÑÑ‚ÑŒ Ð¿Ð¾Ð·Ð¸Ñ‚Ð¸Ð²Ð½Ð¸Ñ… Ñ‚Ð° Ð½ÐµÐ³Ð°Ñ‚Ð¸Ð²Ð½Ð¸Ñ… Ð¿Ð°Ñ€ Ñƒ Ð¾Ð±Ð¾Ñ… Ð½Ð°Ð±Ð¾Ñ€Ð°Ñ… Ð¿Ð¾Ð²Ð¸Ð½Ð½Ð° Ð±ÑƒÑ‚Ð¸ Ð·Ð±Ð°Ð»Ð°Ð½ÑÐ¾Ð²Ð°Ð½Ð°
# -------> 2.1. ÐžÑÐºÑ–Ð»ÑŒÐºÐ¸ Ðº-ÑÑ‚ÑŒ Ð½ÐµÐ³Ð°Ñ‚Ð¸Ð²Ð½Ð¸Ñ… Ð¿Ð°Ñ€ ~3 Ñ€Ð°Ð·Ð¸ Ð±Ñ–Ð»ÑŒÑˆÐ° Ð·Ð° Ðº-ÑÑ‚ÑŒ Ð¿Ð¾Ð·Ð¸Ñ‚Ð¸Ð²Ð½Ð¸Ñ… Ð¿Ð°Ñ€, Ñ‚Ð¾ Ð¿Ñ€Ð¾Ñ†ÐµÑ Ñ„Ð¾Ñ€Ð¼ÑƒÐ²Ð°Ð½Ð½Ñ train/test 
#               Ð½Ð°Ð±Ð¾Ñ€Ñ–Ð² Ð´Ð°Ð½Ð¸Ñ… Ð¿Ð¾Ð²Ð¸Ð½ÐµÐ½ Ð²Ñ–Ð´ÑˆÑ‚Ð¾Ð²Ñ…ÑƒÐ²Ð°Ñ‚Ð¸ÑÑ Ð²Ñ–Ð´ Ðº-ÑÑ‚Ñ– ÐŸÐžÐ—Ð˜Ð¢Ð˜Ð’ÐÐ˜Ð¥ Ð¿Ð°Ñ€,
#               Ð° Ð·Ð°Ð¹Ð²Ñ– Ð½ÐµÐ³Ð°Ñ‚Ð¸Ð²Ð½Ñ– Ð¿Ð°Ñ€Ð¸ Ð´Ð»Ñ ÐºÐ¾Ð¶Ð½Ð¾Ñ— Ð»ÐµÐ¼Ð¸ - Ð²Ñ–Ð´ÐºÐ¸Ð´Ð°ÑŽÑ‚ÑŒÑÑ, Ð´Ð»Ñ Ð·Ð°Ð±ÐµÐ·Ð¿ÐµÑ‡ÐµÐ½Ð½Ñ Ð±Ð°Ð»Ð°Ð½ÑÑƒ + Ñ‚Ð° - Ð¿Ð°Ñ€.
# ---> 3. Ðš-ÑÑ‚ÑŒ Ð¿Ð¾Ð·Ð¸Ñ‚Ð¸Ð²Ð½Ð¸Ñ… Ñ‚Ð° Ð½ÐµÐ³Ð°Ñ‚Ð¸Ð²Ð½Ð¸Ñ… Ð¿Ð°Ñ€ Ð´Ð»Ñ ÐºÐ¾Ð¶Ð½Ð¾Ñ— Ð»ÐµÐ¼Ð¸ - Ð½Ð°Ð±Ð»Ð¸Ð¶ÑƒÑ”Ñ‚ÑŒÑÑ! Ð´Ð¾ Ð·Ð±Ð°Ð»Ð°Ð½ÑÐ¾Ð²Ð°Ð½Ð¾Ñ—


import json
import random
import stats as stats_data
import numpy as np
import math

import matplotlib.pyplot as plt


# input_file_path = stats_data.pairs_file_path
# train_file_path = stats_data.train_file_path
# test_file_path = stats_data.test_file_path

input_file_path = stats_data.pairs_forms_file_path
train_file_path = stats_data.train_forms_file_path
test_file_path = stats_data.test_forms_file_path

# Set the seed for reproducibility
random.seed(42)

def plot_pos_neg_quantity(pos_pairs_quantity, neg_pairs_quantity):
    if len(pos_pairs_quantity) != len(neg_pairs_quantity):
        raise ValueError("Both lists should have the same length.")
    
    plt.plot(pos_pairs_quantity, neg_pairs_quantity, marker='o', linestyle='-', color='r')
    plt.xlabel("Positive pairs quantity")
    plt.ylabel("Negative pairs quantity")
    plt.title("Each point on plot is Lemma a with some + and - usage examples")
    plt.grid(True)
    plt.show()

def count_pos_neg_pairs(dataset, get_plot=False):
    dataset_expanded = []

    for line in dataset:
        lemma, pairs = next(iter(line.items()))
        line_expanded = {
            "lemma": lemma,
            "pairs": pairs,
            "positive_pairs": [],
            "negative_pairs": [],
            }
 
        for i, pair in enumerate(pairs):
            if pair["label"] == 1:
                line_expanded["positive_pairs"].append(pair)
            elif pair["label"] == 0:
                line_expanded["negative_pairs"].append(pair)

        line_expanded["positive_n"] = len(line_expanded["positive_pairs"])
        line_expanded["negative_n"] = len(line_expanded["negative_pairs"])
        dataset_expanded.append(line_expanded)

    #% =============================================== NOTEWORTHY ==============================================
    #%
    #% ÐžÑÐºÑ–Ð»ÑŒÐºÐ¸ Ð·Ð°Ð³Ð°Ð»Ð¾Ð¼ Ðº-ÑÑ‚ÑŒ Ð¿Ð¾Ð·Ð¸Ñ‚Ð¸Ð²Ð½Ð¸Ñ… Ð¿Ð°Ñ€ Ð¼Ð°Ð¹Ð¶Ðµ Ð² 3 Ð¼ÐµÐ½ÑˆÐ° Ð·Ð° Ðº-ÑÑ‚ÑŒ Ð½ÐµÐ³Ð°Ñ‚Ð¸Ð²Ð½Ð¸Ñ… Ð¿Ð°Ñ€
    #% Total number of Positive [âœš] pairs: 570077
    #% Total number of Negative [-] pairs: 1646559
    #% Ñ‚Ð¾ Ð²Ð°Ð¶Ð»Ð¸Ð²Ð¾ Ñ‰Ð¾Ð± Ñƒ Ñ‚Ñ€ÐµÐ½ÑƒÐ²Ð°Ð»ÑŒÐ½Ð¸Ñ… Ð´Ð°Ð½Ð¸Ñ… Ð±ÑƒÐ»Ð¾ Ð´Ð¾ÑÑ‚Ð°Ñ‚Ð½ÑŒÐ¾ Ð¿Ð¾Ð·Ð¸Ñ‚Ð¸Ð²Ð½Ð¸Ñ… Ð¿Ð°Ñ€ 
    #% Ð´Ð»Ñ ÐµÑ„ÐµÐºÑ‚Ð¸Ð²Ð½Ð¾Ð³Ð¾ Ñ‚Ñ€ÐµÐ½ÑƒÐ²Ð°Ð½Ð½Ñ Ð¼Ð¾Ð´ÐµÐ»Ñ–.
    #% Ð’Ð¸Ð±Ñ–Ñ€ Ð¿ÐµÑ€ÑˆÐ¸Ñ… Ð»ÐµÐ¼ Ð· Ð²Ñ–Ð´ÑÐ¾Ñ€Ñ‚Ð¾Ð²Ð°Ð½Ð¾Ð³Ð¾ ÑÐ¿Ð¸ÑÐºÑƒ Ð·Ð° ÐºÑ–Ð»ÑŒÐºÑ–ÑÑ‚ÑŽ Ð¿Ð¾Ð·Ð¸Ñ‚Ð¸Ð²Ð½Ð¸Ñ… Ð¿Ñ€Ð¸ÐºÐ»Ð°Ð´Ñ–Ð²: Ð¼Ð¾Ð¶Ðµ Ð±ÑƒÑ‚Ð¸ Ð²Ñ–Ð´Ð¼Ñ–Ð½Ð½Ð¸Ð¼ Ð¿Ñ–Ð´Ñ…Ð¾Ð´Ð¾Ð¼ Ð´Ð»Ñ Ð·Ð°Ð±ÐµÐ·Ð¿ÐµÑ‡ÐµÐ½Ð½Ñ Ñ‚Ð¾Ð³Ð¾, Ñ‰Ð¾ Ñƒ Ñ‚Ñ€ÐµÐ½ÑƒÐ²Ð°Ð»ÑŒÐ½Ð¸Ñ… Ð´Ð°Ð½Ð¸Ñ… Ñ” Ð´Ð¾ÑÑ‚Ð°Ñ‚Ð½ÑŒÐ¾ Ð¿Ð¾Ð·Ð¸Ñ‚Ð¸Ð²Ð½Ð¸Ñ… Ð¿Ñ€Ð¸ÐºÐ»Ð°Ð´Ñ–Ð² Ð´Ð»Ñ ÐºÐ¾Ð¶Ð½Ð¾Ñ— Ð»ÐµÐ¼Ð¸. Ð¦Ðµ Ð´Ð¾Ð·Ð²Ð¾Ð»Ð¸Ñ‚ÑŒ Ð¼Ð¾Ð´ÐµÐ»Ñ– Ð½Ð°Ð²Ñ‡Ð°Ñ‚Ð¸ÑÑ Ð½Ð° Ñ€Ñ–Ð·Ð½Ð¾Ð¼Ð°Ð½Ñ–Ñ‚Ð½Ð¸Ñ… Ð¿Ð¾Ð·Ð¸Ñ‚Ð¸Ð²Ð½Ð¸Ñ… Ð·Ñ€Ð°Ð·ÐºÐ°Ñ… Ñ– Ð¿Ð¾ÐºÑ€Ð°Ñ‰Ð¸Ñ‚ÑŒ Ñ—Ñ— Ð·Ð´Ð°Ñ‚Ð½Ñ–ÑÑ‚ÑŒ Ð²Ð¸Ð·Ð½Ð°Ñ‡Ð°Ñ‚Ð¸ ÑÑ…Ð¾Ð¶Ñ–ÑÑ‚ÑŒ Ð´Ð»Ñ Ð½Ð¾Ð²Ð¸Ñ… Ð¿Ð°Ñ€.
    #%
    dataset_sorted = sorted(dataset_expanded, key=lambda x: (x["positive_n"], x["negative_n"]), reverse=True)

    if get_plot:
        pos_pairs_quantity = []
        neg_pairs_quantity = []
        for entry in dataset_sorted:
            pos_pairs_quantity.append(entry["positive_n"])
            neg_pairs_quantity.append(entry["negative_n"])
        plot_pos_neg_quantity(pos_pairs_quantity, neg_pairs_quantity)

    total_pos_n = 0
    total_neg_n = 0
    for entry in dataset_sorted:
        total_pos_n+=entry["positive_n"]
        total_neg_n+=entry["negative_n"]
    print(f"Total number of Positive [âœš] pairs: {total_pos_n}")  # 570_077
    print(f"Total number of Negative [-] pairs: {total_neg_n}")  # 1_646_559

    return dataset_sorted, total_pos_n, total_neg_n


def _filter_elements_by_indexes(elements, indexes):
    return [elements[i] for i in indexes]


def _calc_number_of_examples(lemmas):
    sum_pos = 0
    sum_neg = 0
    for lemma_ex in lemmas:
        sum_pos += lemma_ex["positive_n"]
        sum_neg += lemma_ex["negative_n"]
    return sum_pos, sum_neg


def _remove_random_elements(input_list, n):
    # ! ðŸŒž -> Ñƒ Ñ‚Ñ€ÐµÐ¹Ð½Ñ– Ð±Ð°Ð³Ð°Ñ‚Ð¾ {pos_n 0 neg_n 1}
    #!   Ñ‰Ð¾ Ñ€Ð¾Ð±Ð¸Ñ‚Ð¸ Ð· Ñ‚Ð°ÐºÐ¸Ð¼Ð¸? Ð»Ð¸ÑˆÐ°Ñ‚Ð¸ Ñ‡Ð¸ Ð½Ñ– ?
    if n == 0:  #! Ð»Ð¸ÑˆÐ°Ñ‚Ð¸
        return input_list, []
    
    if n >= len(input_list):
        return input_list, []

    random.shuffle(input_list)

    return input_list[:n], input_list[n:]

def equalize_pos_neg_examples(lemmas_extended, positive_examples_n, df_type):
    lemmas_sorted = sorted(lemmas_extended, key=lambda x: (x["negative_n"], -x["positive_n"]))
  
    for lemma_ex in lemmas_sorted:
        positive_n = lemma_ex["positive_n"]
        lemma_ex["negative_pairs_new"], lemma_ex["negative_pairs_extra"] = _remove_random_elements(lemma_ex["negative_pairs"], positive_n)
        lemma_ex["negative_n_new"] = len(lemma_ex["negative_pairs_new"])

    sum_neg = 0
    for lemma_ex in lemmas_sorted:
        sum_neg += lemma_ex["negative_n_new"]
    # print(f"Train: New number of negative examples: {sum_neg}")

    if sum_neg < positive_examples_n:
        lemmas_extra = []

        for lemma_ex in lemmas_sorted:
            positive_n = lemma_ex["positive_n"]
            if lemma_ex["negative_n_new"] < lemma_ex["negative_n"]:
                lemmas_extra.append(lemma_ex)

     
        for i in range (positive_examples_n - sum_neg):
            rand_lemma = {"negative_pairs_extra": []}
            while not rand_lemma["negative_pairs_extra"]:
                rand_lemma = random.choice(lemmas_extra)
                
            new_ex = random.choice(rand_lemma["negative_pairs_extra"])
            rand_lemma["negative_pairs_new"].append(new_ex)
            rand_lemma["negative_n_new"] = len(rand_lemma["negative_pairs_new"])
            rand_lemma["negative_pairs_extra"].remove(new_ex)

    sum_neg = 0
    for lemma_ex in lemmas_sorted:
        sum_neg += lemma_ex["negative_n_new"]
    print(f"ðŸ”¥ {df_type}: New number of negative examples: {sum_neg}")

    return lemmas_sorted


# ! Ñƒ Ñ‚ÐµÑÑ‚Ñ– Ð½Ðµ Ð¼Ð°Ñ” Ð±ÑƒÑ‚Ð¸ Ñ‚Ð¸Ñ… Ð»ÐµÐ¼ Ñ‰Ð¾ Ð² Ñ‚Ñ€ÐµÐ¹Ð½ 
def split_jsonl(input_file, train_file, test_file, split_ratio=0.75):
    with open(input_file, 'r', encoding='utf-8') as file:
        lines = [json.loads(line) for line in file]
        
    lemmas_sorted, total_pos_n, total_neg_n = count_pos_neg_pairs(lines)  
    #% ÐŸÑ€Ð¾Ñ†ÐµÑ Ñ„Ð¾Ñ€Ð¼ÑƒÐ²Ð°Ð½Ð½Ñ train/test Ð½Ð°Ð±Ð¾Ñ€Ñ–Ð² Ð´Ð°Ð½Ð¸Ñ… Ð¿Ð¾Ð²Ð¸Ð½ÐµÐ½ Ð²Ñ–Ð´ÑˆÑ‚Ð¾Ð²Ñ…ÑƒÐ²Ð°Ñ‚Ð¸ÑÑ Ð²Ñ–Ð´ Ðº-ÑÑ‚Ñ– ÐŸÐžÐ—Ð˜Ð¢Ð˜Ð’ÐÐ˜Ð¥ Ð¿Ð°Ñ€,
    #% Ð° Ð¾ÑÐºÑ–Ð»ÑŒÐºÐ¸ Ðº-ÑÑ‚ÑŒ Ð½ÐµÐ³Ð°Ñ‚Ð¸Ð²Ð½Ð¸Ñ… Ð¿Ð°Ñ€ Ñƒ Ð½Ð°Ñ Ð´Ð¾ÑÑ‚Ð°Ñ‚Ð½ÑŒÐ¾, Ñ‚Ð¾ Ð¼Ð¸ Ð¼Ð¾Ð¶ÐµÐ¼Ð¾ Ñ—Ñ… Ð²Ñ–Ð´ÐºÐ¸Ð´Ð°Ñ‚Ð¸, Ð´Ð»Ñ Ð·Ð°Ð±ÐµÐ·Ð¿ÐµÑ‡ÐµÐ½Ð½Ñ Ð±Ð°Ð»Ð°Ð½ÑÑƒ + Ñ‚Ð° -
    #% Ð£ Ð´Ð¾Ð´Ð°Ñ‚Ð¾Ðº Ð² Ñ‚Ñ€ÐµÐ½ÑƒÐ²Ð°Ð»ÑŒÐ½Ð¾Ð¼Ñƒ Ð½Ð°Ð±Ð¾Ñ€Ñ–, ÑÐº Ð·Ð³Ð°Ð´ÑƒÐ²Ð°Ð»Ð¾ÑÑ Ð²Ð¸Ñ‰Ðµ, Ð¼Ð°Ñ” Ð±ÑƒÑ‚Ð¸ Ð»ÐµÐ¼Ð¸ Ð· Ð²ÐµÐ»Ð¸ÐºÐ¾ÑŽ Ðº-ÑÑ‚ÑŽ Ð¿Ð¾Ð·Ð¸Ñ‚Ð¸Ð²Ð½Ð¸Ñ… Ð¿Ð°Ñ€

    eval_train_pos_n = math.ceil(total_pos_n*split_ratio)
    eval_test_pos_n = total_pos_n - eval_train_pos_n

    train_lemmas_ids = []
    test_lemmas_ids = []
    quantity_i = 0
    for i, lemma_extended in enumerate(lemmas_sorted):
        if quantity_i+lemma_extended["positive_n"] < eval_train_pos_n: # ! Ñ‡ÐµÑ€ÐµÐ· Ñ†Ðµ ðŸŒž Ñƒ Ñ‚Ñ€ÐµÐ¹Ð½Ñ– Ð±Ð°Ð³Ð°Ñ‚Ð¾ pos 0 neg 1
            train_lemmas_ids.append(i)
            quantity_i+=lemma_extended["positive_n"]
        else:
            test_lemmas_ids.append(i)
        
    train_lemmas_extened = _filter_elements_by_indexes(lemmas_sorted, train_lemmas_ids)
    test_lemmas_extened = _filter_elements_by_indexes(lemmas_sorted, test_lemmas_ids)

    actual_train_pos_n, actual_train_neg_n = _calc_number_of_examples(train_lemmas_extened)
    actual_test_pos_n, actual_test_neg_n = _calc_number_of_examples(test_lemmas_extened)
    print(f"Train actual: positiveðŸ”¥ = {actual_train_pos_n}  (eval: {eval_train_pos_n}) | negative = {actual_train_neg_n}")
    print(f"Test  actual: positiveðŸ”¥ = {actual_test_pos_n}  (eval: {eval_test_pos_n}) | negative = {actual_test_neg_n}")
    print(f"Total pairs: {actual_train_pos_n + actual_train_neg_n + actual_test_pos_n + actual_test_neg_n }")
    #% Train actual: positive = 427_557 (eval: 427_558) | negative = 1_384_267
    #% Test actual: positive  = 142_520 (eval: 142_519) | negative = 262_292
    #% Total pairs: 2216636 âœ…


    #% Ð¢ÐµÐ¿ÐµÑ€ Ñƒ train/test Ð½Ð°Ð±Ð¾Ñ€Ð°Ñ… Ð´Ð°Ð½Ð¸Ñ… Ð·Ñ€Ñ–Ð²Ð½ÑŽÑ”Ð¼Ð¾ Ðº-ÑÑ‚ÑŒ Ð½ÐµÐ³Ð°Ñ‚Ð¸Ð²Ð½Ð¸Ñ… Ð¿Ð°Ñ€ Ð´Ð¾ Ðº-ÑÑ‚Ñ– Ð¿Ð¾Ð·Ð¸Ñ‚Ð¸Ð²Ð½Ð¸Ñ…
    train_lemmas_eq = equalize_pos_neg_examples(train_lemmas_extened, actual_train_pos_n, "Train")
    test_lemmas_eq = equalize_pos_neg_examples(test_lemmas_extened, actual_test_pos_n, "Test")
    
    train_final = []
    for lemma_entry in train_lemmas_eq:
        train_final.extend(lemma_entry["negative_pairs_new"] + lemma_entry["positive_pairs"])
    random.shuffle(train_final)

    test_final = []
    for lemma_entry in test_lemmas_eq:
        test_final.extend(lemma_entry["negative_pairs_new"] + lemma_entry["positive_pairs"])
    random.shuffle(test_final)


    print(f"Train final: {len(train_final)}") # 427557 * 2 = 855114
    print(f"Test final: {len(test_final)}")   # 142520 * 2 = 285040

    # Write the train set to a new file
    with open(train_file, 'w', encoding='utf-8') as train_output_file:
        # train_output_file.writelines(train_final)
        for entry in train_final:
            json.dump(entry, train_output_file, ensure_ascii=False)
            train_output_file.write('\n')

    # Write the test set to a new file
    with open(test_file, 'w', encoding='utf-8') as test_output_file:
        # test_output_file.writelines(test_final)
        for entry in test_final:
            json.dump(entry, test_output_file, ensure_ascii=False)
            test_output_file.write('\n')


def main():
    split_jsonl(input_file_path, train_file_path, test_file_path)


if __name__ == '__main__':
    main()


